


declare @strFind as varchar(max)
set @strFind = 'D365_Azure'

SELECT OBJECT_NAME(OBJECT_ID) SP_Name
              ,OBJECT_DEFINITION(OBJECT_ID) SP_Definition
        FROM   sys.procedures
        WHERE  OBJECT_DEFINITION(OBJECT_ID) LIKE '%'+@strFind+'%'



SELECT OBJECT_NAME(object_id) AS MYSPDEFINITION
FROM sys.procedures
WHERE OBJECT_DEFINITION(object_id) LIKE '%D365_Azure%';


        -- =============================================  -- Author:  <Author,,Name>  -- Create date: <Create Date,,>  -- Description: <Description,,>  -- =============================================  CREATE PROCEDURE [dbo].[LoadGLStagingFromAzure_5x]    -- Add the parameters for the stored procedure here   @BegDate datetime,    @EndDate Datetime  AS  BEGIN   -- SET NOCOUNT ON added to prevent extra result sets from   -- interfering with SELECT statements.   SET NOCOUNT ON;        -- Insert statements for procedure here   Truncate table AzureGLStaging;        INSERT INTO [dbo].[AzureGLStaging]             ([Scenario]             ,[Entity]             ,[Account]             ,[HasLID]             ,[Value1]             ,[Value2]             ,[Value3]             ,[TimePeriod]             ,[RowComment]             ,[Source]             ,[RuleID]             ,[CreatedOn]             ,[CreatedBY]             ,[UpdatedOn]             ,[UpdatedBY]             ,[AccountString]             ,[Community]             ,[LOS]             ,[DEPT]             ,[Category]             ,[c_JournalEntry]             ,[c_reference]             ,[c_TrxSource]             ,[c_SourceDoc]             ,[c_originalsource]             ,[c_OriginalMasterID]             ,[c_OriginalMasterName]             ,[c_OriginalDocumentNumber]             ,[c_BatchNumber]             ,[c_Series]             ,[c_LastUser]             ,[c_OriginalPostedDate]             ,[c_DateLastEdited]             ,[c_userwhoposted])   (select     1 as Scenario,   1 as Entity,   SLV.FD1 as Account,   0 as HasLID,   (SLV.TRANSACTIONCURRENCYCREDITAMOUNT * -1) + SLV.TRANSACTIONCURRENCYDEBITAMOUNT as Value1,   SLV.TRANSACTIONCURRENCYCREDITAMOUNT as Value2,   SLV.TRANSACTIONCURRENCYDEBITAMOUNT as Value3,   Convert(varchar, SLV.ACCOUNTINGDATE, 112) as TimePeriod,   Null as RowComment,   'D365' as Source,   Null as RuleID,   getdate() as CreatedOn,   'LoadGLStagingFromAzure_5x' as CreatedBY,   GetDate() as UpdatedOn,      Cast(SUSER_SNAME() as nvarchar(50)) as UpdatedBy,   SLV.fd2 +'-'+ SLV.FD3 +'-'+ SLV.FD1 +'-'+ Left(slv.fd4, 2) as AccountString,   Cast(SLV.FD2 as char(2)) as Company,   cast(SLV.FD3 as Char(2)) as LOS,   cast(left(SLV.FD4, 2) as char(2)) as DEPT,   2 as Category,   SLV.LedgerEntryJournalID as c_JournalEntry,   SLV.DESCRIPTION as c_reference,   SLV.JOURNALNUMBER as c_TrxSource,   Case    when slv.subledgervoucher like 'API%' then 'API'    when slv.subledgervoucher like 'PAY%' then 'PAY'    when slv.subledgervoucher like 'REV%' then 'REV'    when slv.subledgervoucher like 'GJN%' then 'GJ'    when slv.subledgervoucher like 'INTCO%' then 'INTCO'    when slv.subledgervoucher like 'INV%' then 'INV'    when slv.subledgervoucher like 'DEP%' then 'DEP'    when slv.subledgervoucher like 'EXR%' then 'EXR'    when slv.subledgervoucher like 'VP%' then 'VP'   else    'N/A'    End as c_SourceDoc,   SLV.VOUCHER as c_originalsource,   vs.vendor as c_OriginalMasterID,   v.VendorOrganizationName as c_OriginalMasterName,   vs.INVOICENO   as c_OriginalDocumentNumber,   SLV.VOUCHER as c_BatchNumber,   SLV.VOUCHER   as c_Series,    SLV.GJCreatedBY as c_LastUser,   SLV.GJCreatedDateTime as c_OriginalPostedDate,   SLV.GJCreatedDateTime as c_DateLastEdited,   SLV.GJCREATEDBY as c_userwhoposted  from [D365_Azure].[d365_Azure_SQL_Exports].dbo.SLVGeneralJournalAccountEntryStaging as SLV   left outer join [D365_Azure].[d365_Azure_SQL_Exports].dbo.LedgerJournalLineCDSStaging as LCDS on (slv.LEDGERENTRYJOURNALID = LCDS.JOURNALBATCHNUMBER                             and slv.SUBLEDGERVOUCHER = LCDS.VOUCHER                             and slv.TEXT = lcds.TEXT                             and LCDS.ACCOUNTDISPLAYVALUE like '[A-Z]%'                              )   left outer join [D365_Azure].[d365_Azure_SQL_Exports].dbo.SLVVendorSpendStaging VS on SLV.GENERALJOURNALACCOUNTENTRYRECID = VS.TRANSACTIONID   left outer join [D365_Azure].[d365_Azure_SQL_Exports].dbo.VendVendorV2Staging V on vs.vendor = V.VendorAccountNumber  --Where SLV.GJCreatedDateTime Between @BegDate and @EndDate  where SLV.ACCOUNTINGDATE Between @BegDate and @EndDate   and slv.fiscalcalendarperiodname <> 'Period 13'  -- removes closing entries   and SLV.fd2 not in (76, 77, 78, 84, 98, 99) -- HUD Communities   --and  SLV.GJCreatedDateTime >= '20211220' -- Originally used to only pull part of December 2021 data   and SLV.LedgerEntryJournalID not in ('JBNUM00001','JBNUM00002','JBNUM00003','JBNUM00004','JBNUM00005','JBNUM00006',  --ignores Dec 2021 history records            'JBNUM00007','JBNUM00008','JBNUM00009','JBNUM00010','JBNUM00011','JBNUM00012',            'JBNUM00013','JBNUM00014','JBNUM00015','JBNUM00017','JBNUM00024','JBNUM00025',            'JBNUM00026','JBNUM00027','JBNUM00028','JBNUM00029','JBNUM00030','JBNUM00031',            'JBNUM00032','JBNUM00033','JBNUM00034','JBNUM00035','JBNUM00036','JBNUM00037',            'JBNUM00065','JBNUM00066','JBNUM00067','JBNUM00068','JBNUM00069','JBNUM00070',            'JBNUM00089','JBNUM00090','JBNUM00092','JBNUM00093','JBNUM00094','JBNUM00095',            'JBNUM00096','JBNUM00097','JBNUM00098','JBNUM00099','JBNUM00100','JBNUM00101',            'JBNUM00102','JBNUM00103','JBNUM00104','JBNUM00105','JBNUM00106','JBNUM00107',            'JBNUM00108','JBNUM00109','JBNUM00110','JBNUM00111','JBNUM00112','JBNUM00113',            'JBNUM00115','JBNUM00116','JBNUM00117','JBNUM00118','JBNUM00119','JBNUM00120',            'JBNUM00123','JBNUM01381','JBNUM02128','JBNUM01468'            )  )    declare @recordcount  INT;    set @recordcount = (select count(*) from AzureGLStaging)    Insert into z_D365_Data_Log  values( GETDATE(), @recordcount, 'LoadGLStagingFromAzure_5x', 'LSS')      END  